<div data-opponent-row data-index="<%= index %>" class="border rounded-lg border-highlight/50 p-4 space-y-3 bg-background/30">
  <div class="flex justify-between items-start">
    <span class="text-sm text-grey-text/70">Opponent</span>
    <button type="button"
            data-action="click->opponent-manager#remove"
            class="text-accent-100 hover:text-accent-100/80 text-sm cursor-pointer">
      Remove
    </button>
  </div>

  <%= f.hidden_field :_destroy %>
  <%= f.hidden_field :commander_id, data: { opponent_commander_field: index } %>

  <!-- Commander Search for Opponent -->
  <div class="flex flex-col gap-2">
    <% has_commander = f.object.commander.present? %>

    <!-- Selected Commander Display -->
    <div class="<%= has_commander ? 'flex' : 'hidden' %> items-center gap-3 p-2 border border-highlight rounded bg-background" data-opponent-selected="<%= index %>">
      <img src="<%= f.object.commander&.image_small %>"
           alt="<%= f.object.commander&.name %>"
           class="w-8 h-11 rounded object-cover"
           data-opponent-image="<%= index %>">
      <span class="text-grey-text flex-1" data-opponent-name="<%= index %>"><%= f.object.commander&.name %></span>
    </div>

    <!-- Search Input -->
    <div class="relative">
      <input type="text"
             placeholder="Search opponent's commander..."
             data-opponent-search="<%= index %>"
             data-index="<%= index %>"
             data-action="input->opponent-manager#searchOpponent"
             class="w-full border text-grey-text text-sm rounded bg-background border-highlight focus:border-accent-50 px-3 py-2 <%= has_commander ? 'hidden' : '' %>">
      <div data-opponent-results="<%= index %>"
           class="hidden absolute z-10 w-full mt-1 max-h-48 overflow-y-auto border border-highlight rounded bg-foreground shadow-lg">
      </div>
    </div>
  </div>

  <!-- Did this opponent win? -->
  <div class="flex items-center gap-4">
    <label class="flex items-center gap-2 cursor-pointer">
      <%= f.check_box :won, class: 'text-accent-50 focus:ring-accent-50 cursor-pointer' %>
      <span class="text-sm text-grey-text">This opponent won</span>
    </label>
  </div>

  <!-- Win condition if they won -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
    <%= f.select :win_condition,
        CommanderGame::WIN_CONDITIONS.map { |c| [c, c] },
        { include_blank: 'Win condition...' },
        { class: 'w-full border text-grey-text text-sm rounded bg-background border-highlight focus:border-accent-50 px-3 py-2' } %>

    <%= f.text_field :how_won,
        placeholder: 'How they won (optional)',
        class: 'w-full border text-grey-text text-sm rounded bg-background border-highlight focus:border-accent-50 px-3 py-2' %>
  </div>
</div>
