<%= form_with model: [:admin, tag], class: 'space-y-4', data: { controller: 'color-preview' } do |f| %>
  <% if tag.errors.any? %>
    <div class='p-4 border border-red-500 rounded-lg bg-red-500/10'>
      <ul class='list-disc list-inside text-red-400 text-sm'>
        <% tag.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :name, class: 'block text-sm font-medium text-grey-text mb-1' %>
    <%= f.text_field :name,
        class: 'w-full rounded-md bg-background border-highlight text-white focus:border-accent-50 focus:ring-accent-50',
        placeholder: 'e.g., Tribal, Combo, Aggro',
        data: { color_preview_target: 'nameInput', action: 'input->color-preview#updateName' } %>
  </div>

  <div>
    <%= f.label :color, class: 'block text-sm font-medium text-grey-text mb-1' %>
    <div class='flex items-center gap-3'>
      <input type="color"
             value="<%= tag.color.presence || '#6366f1' %>"
             class='w-12 h-10 rounded-md bg-background border-highlight cursor-pointer'
             data-color-preview-target="colorPicker"
             data-action="input->color-preview#syncFromPicker" />
      <%= f.text_field :color,
          value: tag.color.presence || '#6366f1',
          class: 'flex-1 rounded-md bg-background border-highlight text-white focus:border-accent-50 focus:ring-accent-50',
          placeholder: '#6366f1',
          data: { color_preview_target: 'colorText', action: 'input->color-preview#syncFromText' } %>
    </div>
    <p class='mt-1 text-xs text-grey-text/70'>Preview:
      <span class='inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ml-1 <%= tag_text_color_class(tag.color.presence || '#6366f1') %>'
            style="background-color: <%= tag.color.presence || '#6366f1' %>;"
            data-color-preview-target="preview">
        <%= tag.name.presence || 'Tag Name' %>
      </span>
    </p>
  </div>

  <div>
    <%= f.label :description, class: 'block text-sm font-medium text-grey-text mb-1' %>
    <%= f.text_area :description,
        rows: 2,
        class: 'w-full rounded-md bg-background border-highlight text-white focus:border-accent-50 focus:ring-accent-50',
        placeholder: 'Optional description for this tag' %>
  </div>

  <div class='flex justify-end gap-3 pt-2'>
    <%= link_to 'Cancel', admin_tags_path,
        class: 'px-4 py-2 text-sm transition border rounded-md border-highlight text-grey-text hover:bg-foreground hover:text-accent-100 hover:border-accent-100' %>
    <%= f.submit tag.persisted? ? 'Update Tag' : 'Create Tag',
        class: 'px-4 py-2 text-sm transition rounded-md bg-accent-50 text-foreground border border-accent-50 hover:bg-foreground hover:text-accent-50 cursor-pointer' %>
  </div>
<% end %>
