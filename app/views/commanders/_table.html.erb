<% visible_column_count = 5 %>
<div class='mb-24 overflow-hidden border rounded-3xl border-highlight'>
  <table class="min-w-full divide-y table-auto divide-background">
    <thead class="bg-background">
      <tr>
        <th class="px-4 py-3 text-xs font-normal tracking-wider text-left normal-case text-grey-text">
          <%= link_to load_commanders_path(sort_params('name')), data: { turbo_stream: true }, class: 'flex items-center gap-1 hover:text-white' do %>
            Name
            <% if @sort_column == 'name' %>
              <span class="text-accent-50"><%= @sort_direction == 'asc' ? '▲' : '▼' %></span>
            <% end %>
          <% end %>
        </th>
        <th class="hidden px-4 py-2 text-xs font-normal tracking-wider text-left normal-case text-grey-text lg:table-cell">
          <%= link_to load_commanders_path(sort_params('card_type')), data: { turbo_stream: true }, class: 'flex items-center gap-1 hover:text-white' do %>
            Type
            <% if @sort_column == 'card_type' %>
              <span class="text-accent-50"><%= @sort_direction == 'asc' ? '▲' : '▼' %></span>
            <% end %>
          <% end %>
        </th>
        <th class="hidden px-4 py-2 text-xs font-normal tracking-wider text-left normal-case text-grey-text md:table-cell">
          <%= link_to load_commanders_path(sort_params('mana_value')), data: { turbo_stream: true }, class: 'flex items-center gap-1 hover:text-white' do %>
            Mana
            <% if @sort_column == 'mana_value' %>
              <span class="text-accent-50"><%= @sort_direction == 'asc' ? '▲' : '▼' %></span>
            <% end %>
          <% end %>
        </th>
        <th class="hidden px-4 py-2 text-xs font-normal tracking-wider text-left normal-case text-grey-text md:table-cell">
          <%= link_to load_commanders_path(sort_params('edhrec_rank')), data: { turbo_stream: true }, class: 'flex items-center gap-1 hover:text-white' do %>
            EDHREC Rank
            <% if @sort_column == 'edhrec_rank' %>
              <span class="text-accent-50"><%= @sort_direction == 'asc' ? '▲' : '▼' %></span>
            <% end %>
          <% end %>
        </th>
        <th class="hidden px-4 py-2 text-xs font-normal tracking-wider text-left normal-case lg:table-cell text-grey-text">
          <%= link_to load_commanders_path(sort_params('edhrec_saltiness')), data: { turbo_stream: true }, class: 'flex items-center gap-1 hover:text-white' do %>
            Salt
            <% if @sort_column == 'edhrec_saltiness' %>
              <span class="text-accent-50"><%= @sort_direction == 'asc' ? '▲' : '▼' %></span>
            <% end %>
          <% end %>
        </th>
      </tr>
    </thead>
    <tbody class="bg-background" data-controller="expandable-row">
      <% @magic_cards.each do |card| %>
        <tr data-action="click->expandable-row#toggle" data-card-id="<%= card.id %>" class="border border-background text-grey-text bg-foreground hover:bg-menu hover:cursor-pointer">
          <td class="px-4 py-2 text-sm whitespace-nowrap">
            <i class="drop-shadow-nine py-1 rounded-xl ss ss-grad ss-<%= card.boxset.keyrune_code&.downcase %> ss-<%= card.rarity&.downcase || 'common' %> ss-fw ss-2x mr-4"></i>
            <% if card&.card_side == 'a' %>
              <%= card.name.split('//')[0]%>
            <% elsif card&.card_side == 'b' %>
              <%= card.name.split('//')[1]%>
            <% else %>
              <%= card.name %>
            <% end %>
            <% if card.etched_finish? %>
              <span class="ml-2 px-1.5 py-0.5 text-xs rounded bg-purple-900/30 text-purple-400 border border-purple-500/30" title="Etched finish">E</span>
            <% end %>
            <% if card.is_token %>
              <span class="ml-2 px-1.5 py-0.5 text-xs rounded bg-amber-900/30 text-amber-400 border border-amber-500/30" title="Token">T</span>
            <% end %>
          </td>
          <td class="hidden px-4 py-2 text-sm whitespace-nowrap lg:table-cell"><%= card.card_type %></td>
          <td class="hidden px-4 py-2 text-sm whitespace-nowrap md:table-cell">
            <div class='flex items-center m-0 space-x-1'>
              <%= mana_symbols(card.mana_cost) %>
            </div>
          </td>
          <td class="hidden px-4 py-2 text-sm whitespace-nowrap md:table-cell">
            <% if card.edhrec_rank.present? %>
              <%= number_with_delimiter(card.edhrec_rank) %>
            <% end %>
          </td>
          <td class="hidden px-4 py-2 text-sm whitespace-nowrap lg:table-cell">
            <% if card.edhrec_saltiness.present? %>
              <%= number_with_precision(card.edhrec_saltiness, precision: 2) %>
            <% end %>
          </td>
        </tr>
        <tr data-expandable-row-target="content" data-card-id="<%= card.id %>" class="hidden border border-background">
          <td colspan="<%= visible_column_count %>">
            <%= turbo_frame_tag "card_details_#{card.id}", src: boxset_magic_card_path(card.id), loading: :lazy %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <div class='flex flex-row items-center justify-between w-full p-6 space-x-4'>
    <%== @pagy.info_tag() %>
    <%== @pagy.series_nav(link_extra: 'data-turbo-stream="true"') %>
  </div>
</div>
