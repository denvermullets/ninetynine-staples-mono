<%= form_with url: search_path, method: :get, local: false,
    class: 'contents',
    id: 'search-form',
    data: {
      controller: 'search-filter multiselect',
      action: 'submit->search-filter#submit',
      search_filter_target: 'form',
      search_filter: 'form' } do |form| %>
  <!-- Search Field -->
  <div class="flex-1 w-full md:min-w-[200px] md:max-w-[400px]">
    <div class='flex flex-col'>
      <h3 class='mb-2 text-grey-text'>Search</h3>
      <div class='flex flex-row space-x-0'>
        <%= form.text_field :search,
              value: params[:search],
              placeholder: 'Enter card name or type',
              onfocus: "this.select();",
              class: 'w-full border text-grey-text rounded-l-md bg-background border-highlight focus:border-accent-50 focus:ring-accent-50'
          %>
        <%= form.hidden_field :username, value: params[:username] %>
        <%= form.hidden_field :code, value: params[:code] %>
        <%= form.hidden_field :collection_id, value: params[:collection_id] %>
        <%= form.hidden_field :valuable_only, value: params[:valuable_only] %>
        <%= form.submit 'Search',
              class: 'p-2 bg-background text-grey-text rounded-r-md border border-highlight hover:cursor-pointer hover:bg-gray-700'
          %>
      </div>
      <p class='mt-2 text-xs text-grey-text'>Search for a card</p>
    </div>
  </div>
  <!-- Mana Filter -->
  <div class="w-auto">
    <div class='flex flex-col'>
      <h3 class="mb-2 text-grey-text">Mana</h3>
      <div class="flex flex-row flex-wrap">
        <% ['b', 'u', 'w', 'r', 'g', 'c'].each do |mana| %>
          <button
              type="button"
              data-action="click->multiselect#toggle"
            data-multiselect-target="item"
            data-multiselect-group="mana"
            data-value="<%= mana.upcase %>"
            class="cursor-pointer rounded-full p-1 transition border-2 border-transparent data-selected:border-accent-50 data-selected:bg-accent-50/20"
            >
            <i class="no-tailwind ms ms-cost ml-0 <%= "ms-#{mana}" %>"></i>
          </button>
        <% end %>
      </div>
      <p class='mt-2 text-xs text-grey-text'>Select color to filter by</p>
    </div>
  </div>
  <!-- Rarity Filter -->
  <div class="w-auto">
    <div class='flex flex-col'>
      <h3 class='mb-2 text-grey-text'>Rarity</h3>
      <div class='flex flex-row flex-wrap'>
        <% ['mythic', 'rare', 'uncommon', 'common'].each do |rarity| %>
          <button
              type="button"
              data-action="click->multiselect#toggle"
            data-multiselect-target="item"
            data-multiselect-group="rarity"
            data-value="<%= rarity %>"
            class="cursor-pointer rounded-full p-1 transition border-2 border-transparent data-selected:border-accent-50 data-selected:bg-accent-50/20"
            >
            <i class='no-tailwind  ml-0 ss ss-<%= rarity %> ms-2x'></i>
          </button>
        <% end %>
      </div>
      <p class='mt-2 text-xs text-grey-text'>Select rarity to filter by</p>
    </div>
  </div>
  <!-- Price Change Filter -->
  <div class="w-auto min-w-[200px]">
    <div class='flex flex-col'>
      <h3 class='mb-2 text-grey-text'>Price Change (7 days)</h3>
      <%= form.select :price_change_range,
            options_for_select([
              ['All Cards', ''],
              ['-100% to -96%', '-100,-96'],
              ['-95% to -91%', '-95,-91'],
              ['-90% to -86%', '-90,-86'],
              ['-85% to -81%', '-85,-81'],
              ['-80% to -76%', '-80,-76'],
              ['-75% to -71%', '-75,-71'],
              ['-70% to -66%', '-70,-66'],
              ['-65% to -61%', '-65,-61'],
              ['-60% to -56%', '-60,-56'],
              ['-55% to -51%', '-55,-51'],
              ['-50% to -46%', '-50,-46'],
              ['-45% to -41%', '-45,-41'],
              ['-40% to -36%', '-40,-36'],
              ['-35% to -31%', '-35,-31'],
              ['-30% to -26%', '-30,-26'],
              ['-25% to -21%', '-25,-21'],
              ['-20% to -16%', '-20,-16'],
              ['-15% to -11%', '-15,-11'],
              ['-10% to -6%', '-10,-6'],
              ['-5% to -1%', '-5,-1'],
              ['0% to 4%', '0,4'],
              ['5% to 9%', '5,9'],
              ['10% to 14%', '10,14'],
              ['15% to 19%', '15,19'],
              ['20% to 24%', '20,24'],
              ['25% to 29%', '25,29'],
              ['30% to 34%', '30,34'],
              ['35% to 39%', '35,39'],
              ['40% to 44%', '40,44'],
              ['45% to 49%', '45,49'],
              ['50% to 54%', '50,54'],
              ['55% to 59%', '55,59'],
              ['60% to 64%', '60,64'],
              ['65% to 69%', '65,69'],
              ['70% to 74%', '70,74'],
              ['75% to 79%', '75,79'],
              ['80% to 84%', '80,84'],
              ['85% to 89%', '85,89'],
              ['90% to 94%', '90,94'],
              ['95% to 99%', '95,99'],
              ['100%+', '100,999']
            ], params[:price_change_range]),
            {},
            {
              class: 'w-full border text-grey-text rounded-md bg-background border-highlight focus:border-accent-50 focus:ring-accent-50',
              data: { action: 'change->search-filter#submitForm' }
            }
        %>
      <p class='mt-2 text-xs text-grey-text'>Filter by price change</p>
    </div>
  </div>
  <% if local_assigns[:show_price_filter] %>
    <!-- Price Filter -->
    <div class="w-auto">
      <div class='flex flex-col'>
        <h3 class='mb-2 text-grey-text'>Price Filter</h3>
        <div class="flex flex-row flex-wrap">
          <button
                type="button"
                data-action="click->search-filter#setPriceFilter"
            data-value="false"
            class="cursor-pointer px-4 py-2 text-sm rounded-lg transition border-2 border-transparent <%= params[:valuable_only] != 'true' ? 'bg-highlight text-nine-white' : 'bg-background text-grey-text hover:bg-menu' %>"
            >
            All Cards
          </button>
          <button
                type="button"
                data-action="click->search-filter#setPriceFilter"
            data-value="true"
            class="cursor-pointer px-4 py-2 text-sm rounded-lg transition border-2 border-transparent <%= params[:valuable_only] == 'true' ? 'bg-highlight text-nine-white' : 'bg-background text-grey-text hover:bg-menu' %>"
            >
            Over $0.80
          </button>
        </div>
        <p class='mt-2 text-xs text-grey-text'>Filter by card value</p>
      </div>
    </div>
  <% end %>
  <!-- Hidden fields for selected filters -->
  <div id="filter-hidden-fields" class="hidden"></div>
<% end %>
